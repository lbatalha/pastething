sudo: required
dist: focal
branches:
        only:
                - master
                - tests
language: python
python:
        - "3.5"
        - "3.6"
        - "3.7"
        - "3.8"
        - "3.9"
        - "3.10"

addons:
        postgresql: "13"
        apt:
                packages:
                        - postgresql-13
                        - postgresql-client-13
env:
  global:
  - PGPORT=5432

services:
        - postgresql
install:
        - "pip install -r requirements.txt"
        - "pip install pylint requests"

before_script:
        - psql -U postgres -f schema.sql
        - "cp config.py.example config.py"


script:
        - "pylint main.py gc.py stats.py"
        - "python3 main.py &"
        - "pytest tests.py"
